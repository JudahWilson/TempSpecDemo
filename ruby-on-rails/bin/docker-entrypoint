#!/bin/bash
set -e

APP_DIR=/app

# â”€â”€ bootstrap only if the volume is empty â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
if [ ! -f "$APP_DIR/config.ru" ]; then
  echo "â–¶ No Rails app detected - generating one..."

  cd $APP_DIR
  rails new . \
    --skip-test --skip-javascript --skip-hotwire --skip-git \
    --database=sqlite3 --force

  bundle install
  rails db:prepare

  # Minimal â€œhelloâ€ page
  rails generate controller Pages home --skip-routes
  cat > config/routes.rb <<'RUBY'
Rails.application.routes.draw do
  root "pages#home"
end
RUBY
  echo '<h1>Hello from Dockerized Rails ðŸ‘‹</h1>' > app/views/pages/home.html.erb
fi

exec "$@"
